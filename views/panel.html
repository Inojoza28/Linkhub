<!doctype html>
<html lang="pt-br" class="overflow-x-hidden scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LinkHub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
            animation: {
            // Anima√ß√µes para a nova se√ß√£o HERO
            'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
            'subtle-float': 'subtleFloat 6s ease-in-out infinite alternate',
            
            // Anima√ß√µes existentes
            spin: 'spin 1s linear infinite',
            'slide-up': 'slideUp 3s ease forwards',
          },
          keyframes: {
            // Anima√ß√£o de entrada para os textos da se√ß√£o hero
            fadeInUp: {
              'from': { opacity: '0', transform: 'translateY(10px )' },
              'to': { opacity: '1', transform: 'translateY(0)' },
            },
            // Anima√ß√£o de flutua√ß√£o sutil para os √≠cones decorativos
            subtleFloat: {
              '0%': { transform: 'translateY(0px)' },
              '100%': { transform: 'translateY(-8px)' },
            },
            spin: { 'to': { transform: 'rotate(360deg)' } },
            slideUp: { '0%': { transform: 'translate(-50%, 100%)', opacity: '0' }, '20%': { transform: 'translate(-50%, 0)', opacity: '1' }, '80%': { transform: 'translate(-50%, 0)', opacity: '1' }, '100%': { transform: 'translate(-50%, 100%)', opacity: '0' } },
          },
        },
      },
    };
  </script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      background-color: #f8fafc;
      background-image: radial-gradient(at 50% 0%, #f0f5ff 0%, #f8fafc 100% );
    }

    .truncate-multiline { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; word-break: break-word; }

    .hero-background {
      background-image: 
        linear-gradient(rgba(14, 21, 35, 0.3), rgba(14, 21, 35, 0.3)),
        radial-gradient(circle at 50% 45%, #0d4dd0, #1e293b 90%);
    }
  
    .truncate-multiline { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; word-break: break-word; }
    
    /* Estilos para as anima√ß√µes em sequ√™ncia */
    .animate-fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-500 { animation-delay: 0.5s; }
  </style>
</head>
<body class="relative min-h-screen flex flex-col bg-gray-50 text-gray-800">

  <!-- Header Fixo -->
  <header class="sticky top-4 sm:top-6 z-30 px-4 w-full">
    <div class="max-w-6xl mx-auto flex items-center justify-between rounded-3xl border border-gray-200/80 bg-white/60 backdrop-blur-xl shadow-lg shadow-gray-900/5 px-6 py-4">
      <a href="#" title="Voltar ao topo" class="flex items-center gap-3 group">
        <div class="relative w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-slate-800 via-blue-700 to-blue-600 flex items-center justify-center shrink-0 ring-1 ring-blue-400/20 ring-inset transition-transform duration-300 group-hover:scale-105">
          <div class="absolute inset-0 rounded-2xl bg-gradient-to-br from-blue-400/20 via-transparent to-cyan-500/10"></div>
          <i data-lucide="network" class="w-5 h-5 sm:w-6 sm:h-6 text-white relative z-10 drop-shadow-lg"></i>
        </div>
        <div class="leading-tight">
          <h1 class="font-bold text-lg tracking-tight bg-gradient-to-r from-slate-800 to-blue-700 text-transparent bg-clip-text group-hover:brightness-125 transition-all duration-300">LinkHub</h1>
        </div>
      </a>
      <nav class="flex items-center gap-2 sm:gap-3">
        <button id="refreshBtn" title="Atualizar lista" class="flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-gray-600 bg-gray-100/80 hover:bg-gray-200/80 hover:text-gray-900 font-semibold transition-all duration-300 transform hover:-translate-y-0.5 active:scale-95 shadow-sm">
          <i data-lucide="refresh-ccw" class="w-4 h-4"></i>
          <span class="hidden sm:inline text-sm">Atualizar</span>
        </button>
        <a href="/logout" title="Sair" class="flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-gray-800 hover:bg-gray-900 text-white text-sm font-semibold transition-all duration-300 transform hover:-translate-y-0.5 active:scale-95 shadow-md">
          <i data-lucide="log-out" class="w-4 h-4"></i>
          <span class="hidden sm:inline">Sair</span>
        </a>
      </nav>
    </div>
  </header>

  <!-- Conte√∫do Principal -->
  <main class="flex-1 max-w-6xl mx-auto px-4 w-full">
    
    <!-- SE√á√ÉO DE BOAS-VINDAS (HERO SECTION) -->
    <section class="relative text-center mt-8 sm:mt-12 pt-16 pb-16 sm:pt-24 sm:pb-24 hero-background rounded-3xl sm:rounded-t-none sm:rounded-b-[3rem] overflow-hidden mb-12 sm:mb-16">
      <div class="absolute inset-0 w-full h-full pointer-events-none">
        <i data-lucide="share-2" class="absolute top-[25%] left-[5%] w-6 h-6 sm:w-8 sm:h-8 text-blue-400/40 animate-subtle-float" style="animation-delay: 0.5s;"></i>
        <i data-lucide="wifi" class="hidden sm:block absolute top-[15%] right-[8%] w-12 h-12 text-blue-400/30 animate-subtle-float"></i>
        <i data-lucide="at-sign" class="hidden md:block absolute bottom-[15%] left-[15%] w-8 h-8 sm:w-10 sm:h-10 text-blue-400/35 animate-subtle-float" style="animation-delay: 1s;"></i>
        <i data-lucide="users" class="absolute bottom-[20%] right-[15%] w-7 h-7 text-blue-400/40 animate-subtle-float" style="animation-delay: 1.5s;"></i>
      </div>

      <div class="max-w-3xl mx-auto relative z-10 px-4">
        <p class="font-semibold text-[#759fff] tracking-wider uppercase text-sm animate-fade-in-up delay-100">Campus Party 2025</p>
        
        <h2 class="mt-3 text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight text-white animate-fade-in-up delay-200">
          Conecte-se em um √∫nico lugar
        </h2>
      
        <p class="mt-4 sm:mt-6 text-base sm:text-lg animate-fade-in-up delay-300">
          <span class="font-bold text-[#759fff]">Cadastre.</span>
          <span class="text-[#e5e7ebdb]">Conecte.</span>
        </p>
      </div>
    </section>



    <!-- Layout Principal (Formul√°rio e Lista) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 lg:gap-12 items-start">
      
      <!-- Coluna do Formul√°rio -->
      <aside class="lg:sticky lg:top-28 col-span-1 w-full mb-8 lg:mb-0">
        <div class="rounded-2xl border border-blue-300/60 bg-gradient-to-br from-blue-50/80 to-white/90 backdrop-blur-sm p-5 sm:p-6 shadow-lg shadow-blue-900/5">
          <h3 class="text-xl font-bold tracking-tight text-gray-900 flex items-center gap-2.5 mb-5">
            <i data-lucide="user-plus" class="w-6 h-6 text-blue-600"></i>
            <span>Participe da Rede</span>
          </h3>
          <form id="register-form" class="space-y-4">
            <div>
              <label for="name" class="text-sm font-medium text-gray-700 mb-1.5 block">Nome</label>
              <div class="relative">
                <i data-lucide="user" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                <input id="name" type="text" required placeholder="Seu nome completo" class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white" />
              </div>
            </div>
            <div>
              <label for="linkedin" class="text-sm font-medium text-gray-700 mb-1.5 block">Perfil LinkedIn</label>
              <div class="relative">
                <i data-lucide="linkedin" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                <input id="linkedin" type="url" required placeholder="https://linkedin.com/in/..." class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white" />
              </div>
            </div>
            <button type="submit" class="w-full rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 shadow-sm hover:shadow-md transition-all transform hover:scale-[1.02] active:scale-[0.99]">
              Entrar na Rede
            </button>
          </form>
        </div>
        <div id="alreadyInList" class="hidden mt-6 p-4 rounded-lg flex items-center gap-3 bg-green-50 border border-green-200 text-green-800">
          <i data-lucide="check-circle" class="w-5 h-5 shrink-0"></i>
          <span class="text-sm font-medium">√ìtimo! Voc√™ j√° faz parte da rede.</span>
        </div>
      </aside>

      <!-- Coluna da Lista de Participantes -->
      <section class="col-span-1 lg:col-span-2 w-full">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
          <div class="w-full sm:w-auto">
            <h3 class="text-2xl font-bold tracking-tight text-gray-900">Participantes</h3>
            <p id="count" class="text-sm text-gray-600 mt-1"></p>
          </div>
          <div class="relative w-full sm:w-auto">
            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
            <input id="searchInput" type="text" placeholder="Buscar por nome..." class="w-full sm:w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition" />
          </div>
        </div>
        <div id="grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"></div>
        <div id="empty" class="hidden text-center py-16 px-6 rounded-2xl border-2 border-dashed border-gray-200 bg-white">
          <i data-lucide="sparkles" class="w-10 h-10 text-blue-500 mx-auto mb-4"></i>
          <h3 class="font-semibold text-gray-800">Seja o primeiro a entrar!</h3>
          <p class="text-sm text-gray-500 mt-1">Cadastre-se no formul√°rio ao lado para aparecer aqui.</p>
        </div>
      </section>
    </div>
    
    <!-- Se√ß√£o "Conecte-se" movida para o final da p√°gina -->
    <div class="mt-16">
        <div class="rounded-2xl border border-gray-200/80 bg-white/80 backdrop-blur-sm p-6 sm:p-8 shadow-lg shadow-gray-900/5">
            <h3 class="text-xl font-bold tracking-tight text-gray-900 flex items-center gap-3 mb-5">
                <i data-lucide="heart-handshake" class="w-6 h-6 text-red-500"></i>
                <span>Gostou do Projeto?</span>
            </h3>
            <p class="text-gray-600 mb-6 text-sm sm:text-base">
                Me siga nas redes sociais para acompanhar mais e trocar ideias!
            </p>
            <div class="flex flex-wrap items-center gap-4">
                <a href="https://www.instagram.com/dev_inojoza_/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2.5 px-4 py-2.5 rounded-lg bg-gray-100 hover:bg-gray-200/80 text-gray-700 hover:text-gray-900 font-semibold transition-all duration-300 transform hover:-translate-y-0.5">
                    <i data-lucide="instagram" class="w-5 h-5"></i><span>Instagram</span>
                </a>
                <a href="https://github.com/Inojoza28" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2.5 px-4 py-2.5 rounded-lg bg-gray-100 hover:bg-gray-200/80 text-gray-700 hover:text-gray-900 font-semibold transition-all duration-300 transform hover:-translate-y-0.5">
                    <i data-lucide="github" class="w-5 h-5"></i><span>GitHub</span>
                </a>
                <a href="https://www.linkedin.com/in/gabrielinojoza/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2.5 px-4 py-2.5 rounded-lg bg-gray-100 hover:bg-gray-200/80 text-gray-700 hover:text-gray-900 font-semibold transition-all duration-300 transform hover:-translate-y-0.5">
                    <i data-lucide="linkedin" class="w-5 h-5"></i><span>Linkedin</span>
                </a>
            </div>
        </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="w-full max-w-6xl mx-auto text-center py-8 px-4 text-sm text-gray-500 mt-16">
    <div class="border-t border-gray-200/80 pt-6 flex flex-col sm:flex-row items-center justify-between gap-4">
        <p>Feito com <span class="text-red-500">‚ù§</span> para a Campus Party 2025</p>
        <p>Desenvolvido por <a href="https://www.instagram.com/dev_inojoza_/" target="_blank" rel="noopener noreferrer" class="font-semibold text-gray-600 hover:text-blue-600 transition-colors">Gabriel Inojoza</a></p>
    </div>
  </footer>

  <button id="refreshFloat" title="Atualizar lista" class="hidden fixed bottom-6 right-6 z-40 w-12 h-12 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-110">
    <i data-lucide="refresh-ccw" class="w-6 h-6 mx-auto"></i>
  </button>

  <template id="card-tpl">
    <div class="card group rounded-xl border border-gray-200/80 bg-white/60 p-4 shadow-md shadow-gray-900/5 transition-all duration-300 hover:shadow-lg hover:border-gray-300 hover:-translate-y-1 border-l-4 border-l-blue-500">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-full text-white grid place-items-center text-lg font-bold shadow-sm shrink-0" data-avatar></div>
        <div class="min-w-0 flex-1">
          <div class="font-semibold text-gray-800 truncate" data-name></div>
          <a class="text-sm text-gray-500 hover:text-blue-600 transition-colors truncate-multiline" target="_blank" rel="noopener" data-link></a>
        </div>
        <a class="p-2 rounded-full text-gray-400 hover:bg-blue-50 hover:text-blue-600 transition-colors" target="_blank" rel="noopener" data-btn title="Ver no LinkedIn">
          <i data-lucide="arrow-up-right" class="w-5 h-5"></i>
        </a>
      </div>
    </div>
  </template>

  <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 px-5 py-3 rounded-lg shadow-xl hidden z-50 text-sm font-medium backdrop-blur-md border w-11/12 max-w-sm text-center"></div>


  <script>
    lucide.createIcons();
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const count = document.getElementById('count');
    const form = document.getElementById('register-form');
    const nameInput = document.getElementById('name');
    const linkedinInput = document.getElementById('linkedin');
    const toast = document.getElementById('toast');
    const refreshBtn = document.getElementById('refreshBtn');
    const refreshFloat = document.getElementById('refreshFloat');
    const alreadyInList = document.getElementById('alreadyInList');
    const searchInput = document.getElementById('searchInput');
    let allParticipants = [];

    function showToast(text, type = "info") {
      toast.textContent = text;
      toast.className = "fixed bottom-6 left-1/2 -translate-x-1/2 px-5 py-3 rounded-lg shadow-xl z-50 text-sm font-medium backdrop-blur-md border w-11/12 max-w-sm text-center animate-slide-up";
      if (type === "success") toast.classList.add("bg-green-500/15", "text-green-800", "border-green-200");
      else if (type === "error") toast.classList.add("bg-red-500/15", "text-red-800", "border-red-200");
      else toast.classList.add("bg-blue-500/15", "text-blue-800", "border-blue-200");
      toast.classList.remove("hidden");
      setTimeout(() => toast.classList.add("hidden"), 3000);
    }

    function colorFromString(s) {
      let h = 0; for (let i = 0; i < s.length; i++) h = (h * 31 + s.charCodeAt(i)) % 360;
      return `linear-gradient(135deg, hsl(${h} 70% 50%), hsl(${(h + 40) % 360} 70% 60%))`;
    }

    function renderParticipants(list = []) {
      grid.innerHTML = '';
      if (!list.length) {
        empty.classList.remove('hidden');
        grid.classList.add('hidden');
        count.textContent = 'Nenhum participante ainda.';
        return;
      }
      empty.classList.add('hidden');
      grid.classList.remove('hidden');
      count.textContent = `${list.length} participante${list.length > 1 ? 's' : ''} na rede`;
      const tpl = document.getElementById('card-tpl');
      list.forEach(p => {
        const node = tpl.content.cloneNode(true);
        const avatar = node.querySelector('[data-avatar]');
        avatar.style.background = colorFromString(p.name);
        avatar.textContent = (p.name || '?')[0].toUpperCase();
        node.querySelector('[data-name]').textContent = p.name;
        node.querySelector('[data-link]').textContent = p.linkedin_url.replace(/^(https?:\/\/   )?(www\.)?/, '');
        node.querySelector('[data-link]').href = p.linkedin_url;
        node.querySelector('[data-btn]').href = p.linkedin_url;
        grid.appendChild(node);
      });
      lucide.createIcons();
    }

    function checkLocalStorage() {
      const savedLinkedin = localStorage.getItem("myLinkedin");
      if (!savedLinkedin) {
        alreadyInList.classList.add("hidden");
        return;
      }
      const found = allParticipants.some(p => p.linkedin_url === savedLinkedin);
      if (found) {
        alreadyInList.classList.remove("hidden");
        linkedinInput.value = savedLinkedin;
      } else {
        localStorage.removeItem("myLinkedin");
        alreadyInList.classList.add("hidden");
      }
    }

    function applySearchFilter() {
      const query = searchInput.value.trim().toLowerCase();
      const filtered = query ? allParticipants.filter(p => p.name.toLowerCase().includes(query)) : allParticipants;
      renderParticipants(filtered);
    }

    async function loadParticipants(showFeedback = false) {
      try {
        const res = await fetch('/api/participants');
        if (res.status === 401 || res.status === 403) {
          window.location.href = '/';
          return;
        }
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const data = await res.json();
        allParticipants = data.participants || [];
        applySearchFilter();
        checkLocalStorage();
        if (showFeedback) {
          showToast("Lista atualizada!", "info");
          const icon = refreshBtn?.querySelector('i');
          const floatIcon = refreshFloat?.querySelector('i');
          if (icon) icon.classList.add('spin');
          if (floatIcon) floatIcon.classList.add('spin');
          setTimeout(() => {
            if (icon) icon.classList.remove('spin');
            if (floatIcon) floatIcon.classList.remove('spin');
          }, 1000);
        }
      } catch (error) {
        console.error("Falha ao carregar participantes:", error);
        if (showFeedback) {
          showToast("N√£o foi poss√≠vel atualizar. Tente novamente.", "error");
        }
      }
    }

    searchInput.addEventListener('input', applySearchFilter);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const linkedin = linkedinInput.value.trim();
      if (localStorage.getItem("myLinkedin") === linkedin && alreadyInList.offsetParent !== null) {
        showToast("Voc√™ j√° est√° na lista ‚úÖ", "info");
        return;
      }
      try {
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, linkedin })
        });
        const data = await res.json();
        if (res.ok) {
            localStorage.setItem("myLinkedin", linkedin);
            if (data.status === 'created') {
                showToast("Cadastro realizado! üéâ", "success");
                nameInput.value = "";
                linkedinInput.value = "";
            } else if (data.status === 'exists') {
                showToast("Voc√™ j√° est√° na lista ‚úÖ", "info");
            }
            loadParticipants();
        } else {
            throw new Error(data.message || "Erro no servidor");
        }
      } catch (error) {
        showToast(error.message || "Erro ao cadastrar.", "error");
      }
    });

    window.addEventListener("scroll", () => {
      if (window.scrollY > 200) {
        refreshFloat.classList.remove("hidden");
      } else {
        refreshFloat.classList.add("hidden");
      }
    });

    const handleRefresh = () => loadParticipants(true);
    refreshBtn.addEventListener('click', handleRefresh);
    refreshFloat.addEventListener('click', handleRefresh);

    loadParticipants();
    setInterval(() => loadParticipants(false), 60000);
  </script>
</body>
</html>
