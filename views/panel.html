<!doctype html>
<html lang="pt-br" class="overflow-x-hidden scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LinkHub — Campus Party 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            float: 'float 20s infinite alternate',
            'slide-up': 'slideUp 3s ease forwards',
            spin: 'spin 1s linear infinite',
          },
          keyframes: {
            float: {
              'from': { transform: 'translateY(0 ) translateX(0) scale(1)' },
              'to': { transform: 'translateY(-40px) translateX(20px) scale(1.05)' },
            },
            slideUp: {
              '0%': { transform: 'translate(-50%, 100%)', opacity: '0' },
              '20%': { transform: 'translate(-50%, 0)', opacity: '1' },
              '80%': { transform: 'translate(-50%, 0)', opacity: '1' },
              '100%': { transform: 'translate(-50%, 100%)', opacity: '0' },
            },
            spin: { 'to': { transform: 'rotate(360deg)' } },
          },
        },
      },
    };
  </script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .blob { position: absolute; border-radius: 50%; filter: blur(80px ); opacity: 0.3; animation: float 20s infinite alternate; pointer-events: none; }
    .blob-1 { width: 300px; height: 300px; background: #3e69a686; top: 10px; left: 10px; }
    .blob-2 { width: 250px; height: 250px; background: #5a78ba; bottom: 10px; right: 10px; animation-delay: 5s; }
    .truncate-multiline { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; word-break: break-word; }
  </style>
</head>
<body class="relative min-h-screen flex flex-col bg-gray-50 text-gray-800">
  <!-- Fundo Decorativo -->
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>

  <!-- Header com border-radius maior e espaçamento aumentado -->
  <header class="sticky top-4 sm:top-6 z-30 px-4 w-full mb-4">
    <div class="relative max-w-6xl mx-auto flex items-center justify-between rounded-3xl border border-gray-200/80 bg-white/60 backdrop-blur-xl shadow-lg shadow-gray-900/5 px-6 py-4 overflow-hidden">
    <div class="absolute top-0 right-0 w-32 h-full bg-gradient-to-l from-blue-500/40 via-blue-600/20 to-transparent pointer-events-none"></div>

      <div class="flex items-center gap-3">
       <div class="relative w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-slate-800 via-blue-700 to-blue-600 flex items-center justify-center shadow-2xl shadow-slate-900/30 shrink-0 ring-1 ring-blue-400/20 ring-inset group transition-all duration-300 hover:shadow-blue-600/40">
        <div class="absolute inset-0 rounded-2xl bg-gradient-to-br from-blue-400/20 via-transparent to-cyan-500/10"></div>
        
        <i data-lucide="network" class="w-5 h-5 sm:w-6 sm:h-6 text-white relative z-10 drop-shadow-lg group-hover:scale-110 transition-transform duration-300"></i>
      </div>

        <div class="leading-tight">
          <h1 class="font-bold text-gray-900 text-lg tracking-tight">LinkHub</h1>
          <span class="hidden sm:block text-xs text-gray-500">Campus Party 2025</span>
        </div>
      </div>
      <nav class="flex items-center gap-2 sm:gap-3 relative z-10">
        <button id="refreshBtn" title="Atualizar lista" class="flex items-center justify-center gap-2 p-2 sm:px-3 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors">
          <i data-lucide="refresh-ccw" class="w-5 h-5"></i>
          <span class="hidden sm:inline text-sm font-medium">Atualizar</span>
        </button>
        <a href="/logout" title="Sair" class="flex items-center justify-center gap-2 p-2 sm:px-4 rounded-lg bg-gray-800 hover:bg-gray-900 text-white text-sm font-medium transition-colors shadow-sm">
          <i data-lucide="log-out" class="w-4 h-4"></i>
          <span class="hidden sm:inline">Sair</span>
        </a>
      </nav>
    </div>
  </header>

  <!-- Conteúdo Principal com espaçamento maior do header -->
  <main class="flex-1 max-w-6xl mx-auto px-4 pt-12 sm:pt-16 pb-16 w-full">
    <div class="grid grid-cols-1 lg:grid-cols-3 lg:gap-12 items-start">
      <aside class="lg:sticky lg:top-32 col-span-1 w-full mb-8 lg:mb-0">
        <!-- Seção "Participe da Rede" com cor de fundo melhorada -->
        <div class="rounded-2xl border border-blue-200/60 bg-gradient-to-br from-blue-50/80 to-white/90 backdrop-blur-sm p-5 sm:p-6 shadow-lg shadow-blue-900/5">
          <h2 class="text-xl font-bold tracking-tight text-gray-900 flex items-center gap-2.5 mb-5">
            <i data-lucide="user-plus" class="w-6 h-6 text-blue-600"></i>
            <span>Participe da Rede</span>
          </h2>
          <form id="register-form" class="space-y-4">
            <div>
              <label for="name" class="text-sm font-medium text-gray-700 mb-1.5 block">Nome</label>
              <div class="relative">
                <i data-lucide="user" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                <input id="name" type="text" required placeholder="Seu nome completo" class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white" />
              </div>
            </div>
            <div>
              <label for="linkedin" class="text-sm font-medium text-gray-700 mb-1.5 block">Perfil LinkedIn</label>
              <div class="relative">
                <i data-lucide="linkedin" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                <input id="linkedin" type="url" required placeholder="https://linkedin.com/in/..." class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-white" />
              </div>
            </div>
            <button type="submit" class="w-full rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 shadow-sm hover:shadow-md transition-all transform hover:scale-[1.02] active:scale-[0.99]">
              Entrar na Rede
            </button>
          </form>
        </div>
        <div id="alreadyInList" class="hidden mt-6 p-4 rounded-lg flex items-center gap-3 bg-green-50 border border-green-200 text-green-800">
          <i data-lucide="check-circle" class="w-5 h-5 shrink-0"></i>
          <span class="text-sm font-medium">Ótimo! Você já faz parte da rede.</span>
        </div>
      </aside>

      <section class="col-span-1 lg:col-span-2 w-full">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
          <div class="w-full sm:w-auto">
            <h2 class="text-2xl font-bold tracking-tight text-gray-900">Participantes</h2>
            <p id="count" class="text-sm text-gray-600 mt-1"></p>
          </div>
          <div class="relative w-full sm:w-auto">
            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
            <input id="searchInput" type="text" placeholder="Buscar por nome..." class="w-full sm:w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition" />
          </div>
        </div>
        
        <div id="grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"></div>
        
        <div id="empty" class="hidden text-center py-16 px-6 rounded-2xl border-2 border-dashed border-gray-200 bg-white">
            <i data-lucide="sparkles" class="w-10 h-10 text-blue-500 mx-auto mb-4"></i>
            <h3 class="font-semibold text-gray-800">Seja o primeiro a entrar!</h3>
            <p class="text-sm text-gray-500 mt-1">Cadastre-se no formulário acima para aparecer aqui.</p>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-center py-8 px-4 text-sm text-gray-500">
    <p>Feito com <span class="text-red-500">❤</span> por Gabriel para a Campus Party 2025</p>
  </footer>

  <!-- Botão Flutuante de Atualizar -->
  <button id="refreshFloat" title="Atualizar lista" class="hidden fixed bottom-6 right-6 z-40 w-12 h-12 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-110">
    <i data-lucide="refresh-ccw" class="w-6 h-6 mx-auto"></i>
  </button>

  <!-- Template dos Cards com borda lateral esquerda -->
  <template id="card-tpl">
    <div class="card group rounded-xl border border-gray-200/80 bg-white/60 p-4 shadow-md shadow-gray-900/5 transition-all duration-300 hover:shadow-lg hover:border-gray-300 hover:-translate-y-1 border-l-4 border-l-blue-500">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-full text-white grid place-items-center text-lg font-bold shadow-sm shrink-0" data-avatar></div>
        <div class="min-w-0 flex-1">
          <div class="font-semibold text-gray-800 truncate" data-name></div>
          <a class="text-sm text-gray-500 hover:text-blue-600 transition-colors truncate-multiline" target="_blank" rel="noopener" data-link></a>
        </div>
        <a class="p-2 rounded-full text-gray-400 hover:bg-blue-50 hover:text-blue-600 transition-colors" target="_blank" rel="noopener" data-btn title="Ver no LinkedIn">
          <i data-lucide="arrow-up-right" class="w-5 h-5"></i>
        </a>
      </div>
    </div>
  </template>

  <!-- Toast (Notificações ) -->
  <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 px-5 py-3 rounded-lg shadow-xl hidden z-50 text-sm font-medium backdrop-blur-md border w-11/12 max-w-sm text-center"></div>

  <!-- Script (Lógica inalterada) -->
  <script>
    lucide.createIcons();
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const count = document.getElementById('count');
    const form = document.getElementById('register-form');
    const nameInput = document.getElementById('name');
    const linkedinInput = document.getElementById('linkedin');
    const toast = document.getElementById('toast');
    const refreshBtn = document.getElementById('refreshBtn');
    const refreshFloat = document.getElementById('refreshFloat');
    const alreadyInList = document.getElementById('alreadyInList');
    const searchInput = document.getElementById('searchInput');
    let allParticipants = [];

    function showToast(text, type = "info") {
      toast.textContent = text;
      toast.className = "fixed bottom-6 left-1/2 -translate-x-1/2 px-5 py-3 rounded-lg shadow-xl z-50 text-sm font-medium backdrop-blur-md border w-11/12 max-w-sm text-center animate-slide-up";
      if (type === "success") toast.classList.add("bg-green-500/15", "text-green-800", "border-green-200");
      else if (type === "error") toast.classList.add("bg-red-500/15", "text-red-800", "border-red-200");
      else toast.classList.add("bg-blue-500/15", "text-blue-800", "border-blue-200");
      toast.classList.remove("hidden");
      setTimeout(() => toast.classList.add("hidden"), 3000);
    }

    function colorFromString(s) {
      let h = 0; for (let i = 0; i < s.length; i++) h = (h * 31 + s.charCodeAt(i)) % 360;
      return `linear-gradient(135deg, hsl(${h} 70% 50%), hsl(${(h + 40) % 360} 70% 60%))`;
    }

    function renderParticipants(list = []) {
      grid.innerHTML = '';
      if (!list.length) {
        empty.classList.remove('hidden');
        grid.classList.add('hidden');
        count.textContent = 'Nenhum participante ainda.';
        return;
      }
      empty.classList.add('hidden');
      grid.classList.remove('hidden');
      count.textContent = `${list.length} participante${list.length > 1 ? 's' : ''} na rede`;
      const tpl = document.getElementById('card-tpl');
      list.forEach(p => {
        const node = tpl.content.cloneNode(true);
        const avatar = node.querySelector('[data-avatar]');
        avatar.style.background = colorFromString(p.name);
        avatar.textContent = (p.name || '?')[0].toUpperCase();
        node.querySelector('[data-name]').textContent = p.name;
        node.querySelector('[data-link]').textContent = p.linkedin_url.replace(/^(https?:\/\/ )?(www\.)?/, '');
        node.querySelector('[data-link]').href = p.linkedin_url;
        node.querySelector('[data-btn]').href = p.linkedin_url;
        grid.appendChild(node);
      });
      lucide.createIcons();
    }

    function checkLocalStorage() {
      const savedLinkedin = localStorage.getItem("myLinkedin");
      if (!savedLinkedin) {
        alreadyInList.classList.add("hidden");
        return;
      }
      const found = allParticipants.some(p => p.linkedin_url === savedLinkedin);
      if (found) {
        alreadyInList.classList.remove("hidden");
        linkedinInput.value = savedLinkedin;
      } else {
        localStorage.removeItem("myLinkedin");
        alreadyInList.classList.add("hidden");
      }
    }

    function applySearchFilter() {
      const query = searchInput.value.trim().toLowerCase();
      const filtered = query ? allParticipants.filter(p => p.name.toLowerCase().includes(query)) : allParticipants;
      renderParticipants(filtered);
    }

    async function loadParticipants(showFeedback = false) {
      try {
        const res = await fetch('/api/participants');
        if (res.status === 401 || res.status === 403) {
          window.location.href = '/';
          return;
        }
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const data = await res.json();
        allParticipants = data.participants || [];
        applySearchFilter();
        checkLocalStorage();
        if (showFeedback) {
          showToast("Lista atualizada!", "info");
          const icon = refreshBtn?.querySelector('i');
          const floatIcon = refreshFloat?.querySelector('i');
          if (icon) icon.classList.add('spin');
          if (floatIcon) floatIcon.classList.add('spin');
          setTimeout(() => {
            if (icon) icon.classList.remove('spin');
            if (floatIcon) floatIcon.classList.remove('spin');
          }, 1000);
        }
      } catch (error) {
        console.error("Falha ao carregar participantes:", error);
        if (showFeedback) {
          showToast("Não foi possível atualizar. Tente novamente.", "error");
        }
      }
    }

    searchInput.addEventListener('input', applySearchFilter);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const linkedin = linkedinInput.value.trim();
      if (localStorage.getItem("myLinkedin") === linkedin && alreadyInList.offsetParent !== null) {
        showToast("Você já está na lista ✅", "info");
        return;
      }
      try {
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, linkedin })
        });
        const data = await res.json();
        if (res.ok) {
            localStorage.setItem("myLinkedin", linkedin);
            if (data.status === 'created') {
                showToast("Cadastro realizado! 🎉", "success");
                nameInput.value = "";
                linkedinInput.value = "";
            } else if (data.status === 'exists') {
                showToast("Você já está na lista ✅", "info");
            }
            loadParticipants();
        } else {
            throw new Error(data.message || "Erro no servidor");
        }
      } catch (error) {
        showToast(error.message || "Erro ao cadastrar.", "error");
      }
    });

    window.addEventListener("scroll", () => {
      if (window.scrollY > 200) {
        refreshFloat.classList.remove("hidden");
      } else {
        refreshFloat.classList.add("hidden");
      }
    });

    const handleRefresh = () => loadParticipants(true);
    refreshBtn.addEventListener('click', handleRefresh);
    refreshFloat.addEventListener('click', handleRefresh);

    loadParticipants();
    setInterval(() => loadParticipants(false), 60000);
  </script>
</body>
</html>
